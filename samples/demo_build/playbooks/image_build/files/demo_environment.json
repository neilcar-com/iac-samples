{
  "variables": {
      "aws_access_key": "{{env `AWS_ACCESS_KEY_ID`}}",
      "aws_secret_key": "{{env `AWS_SECRET_ACCESS_KEY`}}",
      "aws_region": "{{env `AWS_REGION`}}",
      "google_application_credentials_cto": "/files/workspace/image_build/playbooks/image_build/files/twistlock-cto-lab.json",
      "google_application_credentials_partners": "/files/workspace/image_build/playbooks/image_build/files/twistlock-cto-partners.json",
      "google_application_credentials_ct-demos": "/files/workspace/image_build/playbooks/image_build/files/twistlock-cto-demos.json"
  },
  "builders": [
    {
      "name":"cto-sandbox",
      "type": "googlecompute",
      "account_file": "{{user `google_application_credentials_cto`}}",
      "project_id": "cto-sandbox",
      "source_image": "ubuntu-1604-xenial-v20180912",
      "ssh_username": "ubuntu",
      "machine_type": "n1-standard-2",
      "zone": "us-central1-a",
      "instance_name": "demo-build-{{uuid}}",
      "image_name": "demo-build"
    },
    {
      "name":"twistlock-cto-partners",
      "type": "googlecompute",
      "account_file": "{{user `google_application_credentials_partners`}}",
      "project_id": "twistlock-cto-partners",
      "source_image": "ubuntu-1604-xenial-v20180912",
      "ssh_username": "ubuntu",
      "machine_type": "n1-standard-2",
      "zone": "us-central1-a",
      "instance_name": "demo-build-{{uuid}}",
      "image_name": "demo-build"
    },
    {
      "name":"cto-demos-245420",
      "type": "googlecompute",
      "account_file": "{{user `google_application_credentials_ct-demos`}}",
      "project_id": "cto-demos-245420",
      "source_image": "ubuntu-1604-xenial-v20180912",
      "ssh_username": "ubuntu",
      "machine_type": "n1-standard-2",
      "zone": "us-central1-a",
      "instance_name": "demo-build-{{uuid}}",
      "image_name": "demo-build"
    },
    {
      "type": "amazon-ebs",
      "access_key": "{{user `aws_access_key`}}",
      "ami_name": "demo-build",
      "instance_type": "t2.micro",
      "region": "{{user `aws_region`}}",
      "secret_key": "{{user `aws_secret_key`}}",
      "source_ami_filter": {
        "filters": {
          "virtualization-type": "hvm",
          "name": "ubuntu/images/*ubuntu-xenial-16.04-amd64-server-*",
          "root-device-type": "ebs"
          },
          "owners": ["099720109477"],
          "most_recent": true
      },
      "ssh_username": "ubuntu"
    }
  ],
  "provisioners": [{
    "type": "shell",
    "inline": [
      "sleep 30",
      "sudo apt-get update",
      "sudo apt-get install -y python-dev python-pip",
      "sudo pip install ansible",
      "ansible --version"
    ]
  },
  {
    "type": "ansible-local",
    "playbook_file": "/files/workspace/image_build/playbooks/image_build/files/local.yml",
    "playbook_dir": "/files/workspace/image_build/playbooks/image_build/files/"
  },
  {
      "type": "shell",
      "script": "/files/workspace/image_build/playbooks/image_build/files/infos.sh"
  }]
}
