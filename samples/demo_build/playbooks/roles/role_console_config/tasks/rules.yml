- name: Enable syslog output (<= 2.5)
  uri:
    url: "{{ twistlock_console }}/api/v1/settings/syslog"
    method: POST
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"enabled":true,"verboseScan":true,"allProcEvents":false}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200,404
    # endpoint removed for 18.11

- name: Enable syslog output (18.11+)
  uri:
    url: "{{ twistlock_console }}/api/v1/settings/logging"
    method: POST
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"syslog":{"enabled":true,"verboseScan":false,"allProcEvents":false},"Stdout":{"enabled":false,"verboseScan":false,"allProcEvents":false},"enableMetricsCollection":false}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200,404

- name: CNNF alerts (19.03+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/firewall/network/container"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"containerNetworkFirewall","effect":"alert","rules":[]}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] != "18"

- name: CNNF Host alerts (19.03+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/firewall/network/host"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"hostNetworkFirewall","effect":"alert"}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] != "18"


- name: CNNF alerts (18.11)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/firewall/network"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"networkFirewall","effect":"alert","rules":[]}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] == "18"

- name: Runtime exceptions (18.11+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/runtime/container"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"containerRuntime","rules":[{"name":"Ignore Gogs, Selenium, Jenkins, Splunk","labels":[],"resources":{"hosts":["*"],"images":["gogs/gogs:*","my_jenkins:*","selenium*","splunk:*"],"labels":["*"],"containers":["*"],"services":[],"functions":[]},"advancedProtection":false,"processes":{"effect":"disable","blacklist":[],"whitelist":[],"checkCryptoMiners":true,"checkLateralMovement":true,"checkParentChild":false},"syscalls":{"effect":"disable","staticProfiles":false,"whitelist":[],"blacklist":[]},"network":{"effect":"disable","blacklistIPs":[],"blacklistListeningPorts":[],"whitelistListeningPorts":[],"blacklistOutboundPorts":[],"whitelistOutboundPorts":[],"whitelistIPs":[],"detectPortScan":true},"dns":{"effect":"disable","whitelist":[],"blacklist":[]},"filesystem":{"effect":"disable","blacklist":[],"whitelist":[],"checkNewFiles":true,"backdoorFiles":true},"kubernetes":{"enabled":false}},{"owner":"{{ console_user }}","name":"Default - alert on suspicious runtime behavior","previousName":"","labels":[],"resources":{"hosts":["*"],"images":["*"],"labels":["*"],"containers":["*"]},"advancedProtection":true,"processes":{"effect":"alert","blacklist":[],"whitelist":[],"checkCryptoMiners":true,"checkLateralMovement":true,"checkParentChild":false},"syscalls":{"effect":"alert","staticProfiles":false,"whitelist":[],"blacklist":[]},"network":{"effect":"alert","blacklistIPs":[],"blacklistListeningPorts":[],"whitelistListeningPorts":[],"blacklistOutboundPorts":[],"whitelistOutboundPorts":[],"whitelistIPs":[],"detectPortScan":true},"dns":{"effect":"alert","whitelist":[],"blacklist":[]},"filesystem":{"effect":"alert","blacklist":[],"whitelist":[],"checkNewFiles":true,"backdoorFiles":true},"kubernetes":{"enabled":false}}],"behavioralLearningEnabled":true}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200, 400

- name: Host policy (enable alerts) (19.03)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/runtime/host"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: "{{ lookup('file','rules/host-rules.json') }}"
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200,400
  when: twistlock_version.split('.')[0] != "18"

- name: Host policy (enable alerts) (18.11)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/runtime/host"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"hostRuntime","owner":"system","rules":[{"name":"Default - alert on suspicious runtime behavior","previousName":"Default - alert on suspicious runtime behavior","advancedProtection":"alert","staticProfiles":true,"resources":{"hosts":["*"],"images":[],"labels":[],"containers":[],"services":["*"]},"localAudit":{"sshdEnabled":true,"dockerEnabled":true,"sudoEnabled":true,"readonlyAuditEnabled":true,"historyEnabled":true},"capabilities":{"DOCKER":"alert","DOCKER_SOCKET":"alert","GCLOUD":"alert","HOSTS_CONFIG":"alert","INSTALLER":"alert","KUBERNETES":"alert","NET":"alert","OPENSHIFT":"alert","PRIVILEGED_PROCESSES":"alert","SERVICE_OPERATOR":"alert","SHELL":"alert","SSH":"alert","SYSTEM_LOGS":"alert","USERS_ADMIN":"alert"},"blacklist":{},"whitelist":{}}],"behavioralLearningEnabled":true}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200,400
  when: twistlock_version.split('.')[0] == "18"

# Settings moved in 2.4
- name: Track sshd, sudo, etc
  uri:
    url: "{{ twistlock_console }}/api/v1/settings/local-audit"
    method: POST
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"sshdEnabled":true,"dockerEnabled":true,"sudoEnabled":true,"readonlyAuditEnabled":true}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200,400,404

#Adding ignore_error: true to fix an issue with dirac releases, dirac has a default policy, so we don't need this
- name: Serverless default rule (19.03+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/runtime/serverless"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"containerRuntime","rules":[{"name":"Default","previousName":"Default","resources":{"functions":["*"],"containers":[],"images":[],"labels":[],"hosts":[],"services":[],"raspDefenders":[]},"advancedProtection":false,"processes":{"effect":"alert","blacklist":[],"whitelist":[],"checkCryptoMiners":true,"checkLateralMovement":false,"checkParentChild":false,"blockAllBinaries":true},"syscalls":{"effect":"","staticProfiles":false,"whitelist":[],"blacklist":[]},"network":{"effect":"disable","blacklistIPs":[],"blacklistListeningPorts":[],"whitelistListeningPorts":[],"blacklistOutboundPorts":[],"whitelistOutboundPorts":[],"whitelistIPs":[],"detectPortScan":false},"dns":{"effect":"alert","whitelist":["*.twistlock.com"],"blacklist":[]},"filesystem":{"effect":"","blacklist":[],"whitelist":[],"checkNewFiles":false,"backdoorFiles":false},"kubernetes":{"enabled":false},"customRules":[]}],"learningDisabled":false}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  ignore_errors: true
  when: twistlock_version.split('.')[0] != "18"

- name: Serverless default rule (18.11)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/runtime/serverless"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"containerRuntime","rules":[{"processes":{"effect":"alert","blockAllBinaries":true,"checkCryptoMiners":true,"whitelist":[],"blacklist":[]},"resources":{"functions":["*"],"containers":[],"images":[],"labels":[],"hosts":[],"services":[]},"dns":{"effect":"alert","whitelist":["*.twistlock.com"],"blacklist":[]},"name":"Default"}],"behavioralLearningEnabled":false}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] == "18"

- name: RASP default rule (19.03+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/runtime/rasp"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: "{{ lookup('file','rules/rasp-runtime-rules.json') }}"
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] != "18"

- name: Fargate default rule (18.11)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/runtime/fargate"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"containerRuntime","rules":[{"processes":{"effect":"alert","checkNewBinaries":true,"checkCryptoMiners":true,"whitelist":[],"blacklist":[]},"resources":{"images":["*"],"containers":["*"],"labels":[],"hosts":[],"services":[],"functions":[]},"dns":{"effect":"alert","whitelist":["*.twistlock.com"],"blacklist":[]},"name":"Default"}],"behavioralLearningEnabled":false}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] == "18"

- name: CNAF alerts for default backend & DVWA (19.03+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/firewall/app/container"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"containerAppFirewall","rules":[{"effect":"alert","blacklist":{"advancedProtection":true,"subnets":[]},"whitelistSubnets":[],"libinject":{"xssEnabled":true,"sqliEnabled":true},"headers":{"specs":[]},"resources":{"containers":["*"],"images":["infoslack/dvwa:*"],"hosts":["*"],"labels":["*"],"raspDefenders":[]},"csrfEnabled":true,"clickjackingEnabled":true,"attackToolsEnabled":true,"intelGathering":{"bruteforceEnabled":true,"dirTraversalEnabled":true,"trackErrorsEnabled":true,"infoLeakageEnabled":true,"removeFingerprintsEnabled":true},"shellshockEnabled":true,"malformedReqEnabled":true,"maliciousUpload":{"enabled":true,"allowedFileTypes":["jpeg","gif"],"allowedExtensions":[]},"whitelistURLs":[],"portMaps":[{"internal":80}],"certificate":{},"name":"DVWA"}],"minPort":30000,"maxPort":31000}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] != "18"

- name: CNAF alerts for default backend & DVWA (18.11)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/firewall/app/container"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"_id":"firewall","rules":[{"effect":"alert","blacklist":{"advancedProtection":true,"subnets":[]},"whitelistSubnets":[],"libinject":{"xssEnabled":true,"sqliEnabled":true},"headers":{"specs":[]},"resources":{"containers":["*"],"images":["infoslack/dvwa:latest"],"hosts":["*"],"labels":["*"],"tasks":[]},"csrfEnabled":true,"clickjackingEnabled":true,"attackToolsEnabled":true,"intelGathering":{"bruteforceEnabled":true,"dirTraversalEnabled":true,"trackErrorsEnabled":true,"infoLeakageEnabled":true,"removeFingerprintsEnabled":true},"shellshockEnabled":true,"malformedReqEnabled":true,"maliciousUpload":{"enabled":true,"allowedFileTypes":["gif","jpeg"],"allowedExtensions":[]},"whitelistURLs":[],"portMaps":[{"tls":false,"internal":80}],"name":"DVWA"}],"minPort":30000,"maxPort":31000}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] == "18"

- name: Custom compliance
  uri:
    url: "{{ twistlock_console }}/api/v1/custom-compliance"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"owner":"{{ console_user }}","name":"{{ item.name }}","previousName":"","_id":0,"title":"{{ item.title }}","script":"{{ item.script }}","severity":"{{ item.severity }}"}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200,400,500
  with_items: "{{ custom_compliance_benchmarks }}"

- name: Update Container compliance rules (19.03+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/compliance/container"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"rules":[{"name":"Default - ignore Twistlock components","previousName":"","effect":"alert","resources":{"hosts":["*"],"images":["twistlock*"],"labels":["*"],"containers":["*"]},"action":["*"],"condition":{"readonly":false,"device":"","vulnerabilities":[{"id":56,"block":false,"minSeverity":0},{"id":511,"block":false,"minSeverity":0},{"id":517,"block":false,"minSeverity":0},{"id":598,"block":false,"minSeverity":0},{"id":425,"block":false,"minSeverity":0},{"id":597,"block":false,"minSeverity":0},{"id":424,"block":false,"minSeverity":0},{"id":519,"block":false,"minSeverity":0},{"id":57,"block":false,"minSeverity":0},{"id":524,"block":false,"minSeverity":0},{"id":422,"block":false,"minSeverity":0},{"id":426,"block":false,"minSeverity":0},{"id":516,"block":false,"minSeverity":0},{"id":423,"block":false,"minSeverity":0}]},"group":["*"],"alertThreshold":{"disabled":false,"value":0},"blockThreshold":{"enabled":false,"value":0},"graceDays":0},{"name":"Default - alert on critical and high","previousName":"","effect":"alert","resources":{"hosts":["*"],"images":["*"],"labels":["*"],"containers":["*"]},"action":["*"],"condition":{"readonly":false,"device":"","vulnerabilities":[{"id":41,"block":false,"minSeverity":0},{"id":422,"block":false,"minSeverity":0},{"id":423,"block":false,"minSeverity":0},{"id":424,"block":false,"minSeverity":0},{"id":425,"block":false,"minSeverity":0},{"id":426,"block":false,"minSeverity":0},{"id":510,"block":false,"minSeverity":0},{"id":51,"block":false,"minSeverity":0},{"id":511,"block":false,"minSeverity":0},{"id":512,"block":false,"minSeverity":0},{"id":514,"block":false,"minSeverity":0},{"id":515,"block":false,"minSeverity":0},{"id":516,"block":false,"minSeverity":0},{"id":517,"block":false,"minSeverity":0},{"id":519,"block":false,"minSeverity":0},{"id":52,"block":false,"minSeverity":0},{"id":520,"block":false,"minSeverity":0},{"id":521,"block":false,"minSeverity":0},{"id":524,"block":false,"minSeverity":0},{"id":525,"block":false,"minSeverity":0},{"id":528,"block":false,"minSeverity":0},{"id":530,"block":false,"minSeverity":0},{"id":531,"block":false,"minSeverity":0},{"id":54,"block":false,"minSeverity":0},{"id":55,"block":false,"minSeverity":0},{"id":56,"block":false,"minSeverity":0},{"id":57,"block":false,"minSeverity":0},{"id":58,"block":false,"minSeverity":0},{"id":59,"block":false,"minSeverity":0},{"id":597,"block":false,"minSeverity":0},{"id":598,"block":false,"minSeverity":0},{"id":599,"block":false,"minSeverity":0}]},"group":["*"],"allCompliance":true,"alertThreshold":{"disabled":false,"value":0},"blockThreshold":{"enabled":false,"value":0},"graceDays":0}],"policyType":"containerCompliance","_id":"containerCompliance"}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] != "18"

- name: Update host compliance rules (19.03+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/compliance/host"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"rules":[{"name":"Default - alert on critical and high","previousName":"","effect":"alert","resources":{"hosts":["*"],"containers":[],"images":[],"labels":[],"functions":[]},"condition":{"readonly":false,"device":"","vulnerabilities":[{"id":16,"block":false,"minSeverity":0},{"id":200001,"block":false,"minSeverity":1},{"id":200002,"block":false,"minSeverity":1},{"id":200003,"block":false,"minSeverity":1},{"id":200004,"block":false,"minSeverity":1},{"id":200005,"block":false,"minSeverity":1},{"id":200006,"block":false,"minSeverity":1},{"id":200007,"block":false,"minSeverity":1},{"id":200201,"block":false,"minSeverity":1},{"id":200202,"block":false,"minSeverity":1},{"id":200203,"block":false,"minSeverity":1},{"id":200300,"block":false,"minSeverity":1},{"id":200400,"block":false,"minSeverity":1},{"id":200401,"block":false,"minSeverity":1},{"id":21,"block":false,"minSeverity":0},{"id":211,"block":false,"minSeverity":0},{"id":213,"block":false,"minSeverity":0},{"id":215,"block":false,"minSeverity":0},{"id":217,"block":false,"minSeverity":0},{"id":219,"block":false,"minSeverity":0},{"id":221,"block":false,"minSeverity":0},{"id":224,"block":false,"minSeverity":0},{"id":24,"block":false,"minSeverity":0},{"id":26,"block":false,"minSeverity":0},{"id":28,"block":false,"minSeverity":0},{"id":31,"block":false,"minSeverity":0},{"id":315,"block":false,"minSeverity":0},{"id":316,"block":false,"minSeverity":0},{"id":317,"block":false,"minSeverity":0},{"id":318,"block":false,"minSeverity":0},{"id":319,"block":false,"minSeverity":0},{"id":32,"block":false,"minSeverity":0},{"id":320,"block":false,"minSeverity":0},{"id":33,"block":false,"minSeverity":0},{"id":34,"block":false,"minSeverity":0},{"id":35,"block":false,"minSeverity":0},{"id":36,"block":false,"minSeverity":0},{"id":37,"block":false,"minSeverity":0},{"id":38,"block":false,"minSeverity":0},{"id":6141,"block":false,"minSeverity":0},{"id":6151,"block":false,"minSeverity":0},{"id":6153,"block":false,"minSeverity":0},{"id":61612,"block":false,"minSeverity":0},{"id":61613,"block":false,"minSeverity":0},{"id":62110,"block":false,"minSeverity":0},{"id":6216,"block":false,"minSeverity":0},{"id":6218,"block":false,"minSeverity":0},{"id":6219,"block":false,"minSeverity":0},{"id":62210,"block":false,"minSeverity":0},{"id":62211,"block":false,"minSeverity":0},{"id":62212,"block":false,"minSeverity":0},{"id":62213,"block":false,"minSeverity":0},{"id":62214,"block":false,"minSeverity":0},{"id":62216,"block":false,"minSeverity":0},{"id":62217,"block":false,"minSeverity":0},{"id":6223,"block":false,"minSeverity":0},{"id":6224,"block":false,"minSeverity":0},{"id":6225,"block":false,"minSeverity":0},{"id":6226,"block":false,"minSeverity":0},{"id":6227,"block":false,"minSeverity":0},{"id":6228,"block":false,"minSeverity":0},{"id":6229,"block":false,"minSeverity":0},{"id":6321,"block":false,"minSeverity":0},{"id":6344,"block":false,"minSeverity":0},{"id":6345,"block":false,"minSeverity":0},{"id":6361,"block":false,"minSeverity":0},{"id":641113,"block":false,"minSeverity":0},{"id":64115,"block":false,"minSeverity":0},{"id":64116,"block":false,"minSeverity":0},{"id":64117,"block":false,"minSeverity":0},{"id":64118,"block":false,"minSeverity":0},{"id":6412,"block":false,"minSeverity":0},{"id":6518,"block":false,"minSeverity":0},{"id":6521,"block":false,"minSeverity":0},{"id":65211,"block":false,"minSeverity":0},{"id":6522,"block":false,"minSeverity":0},{"id":6523,"block":false,"minSeverity":0},{"id":6525,"block":false,"minSeverity":0},{"id":6528,"block":false,"minSeverity":0},{"id":6529,"block":false,"minSeverity":0},{"id":65414,"block":false,"minSeverity":0},{"id":6612,"block":false,"minSeverity":0},{"id":6613,"block":false,"minSeverity":0},{"id":6614,"block":false,"minSeverity":0},{"id":6615,"block":false,"minSeverity":0},{"id":6616,"block":false,"minSeverity":0},{"id":6617,"block":false,"minSeverity":0},{"id":6618,"block":false,"minSeverity":0},{"id":6619,"block":false,"minSeverity":0},{"id":6621,"block":false,"minSeverity":0},{"id":66210,"block":false,"minSeverity":0},{"id":66213,"block":false,"minSeverity":0},{"id":66215,"block":false,"minSeverity":0},{"id":66216,"block":false,"minSeverity":0},{"id":66217,"block":false,"minSeverity":0},{"id":66218,"block":false,"minSeverity":0},{"id":6625,"block":false,"minSeverity":0},{"id":6627,"block":false,"minSeverity":0},{"id":6628,"block":false,"minSeverity":0},{"id":6629,"block":false,"minSeverity":0},{"id":8111,"block":false,"minSeverity":0},{"id":81111,"block":false,"minSeverity":0},{"id":81112,"block":false,"minSeverity":0},{"id":81120,"block":false,"minSeverity":0},{"id":8112,"block":false,"minSeverity":0},{"id":81122,"block":false,"minSeverity":0},{"id":81123,"block":false,"minSeverity":0},{"id":81126,"block":false,"minSeverity":0},{"id":81127,"block":false,"minSeverity":0},{"id":81128,"block":false,"minSeverity":0},{"id":81129,"block":false,"minSeverity":0},{"id":81130,"block":false,"minSeverity":0},{"id":81131,"block":false,"minSeverity":0},{"id":81132,"block":false,"minSeverity":0},{"id":81133,"block":false,"minSeverity":0},{"id":81137,"block":false,"minSeverity":0},{"id":81138,"block":false,"minSeverity":0},{"id":8114,"block":false,"minSeverity":0},{"id":8115,"block":false,"minSeverity":0},{"id":8116,"block":false,"minSeverity":0},{"id":8117,"block":false,"minSeverity":0},{"id":8118,"block":false,"minSeverity":0},{"id":8133,"block":false,"minSeverity":0},{"id":8134,"block":false,"minSeverity":0},{"id":8135,"block":false,"minSeverity":0},{"id":8136,"block":false,"minSeverity":0},{"id":8141,"block":false,"minSeverity":0},{"id":81410,"block":false,"minSeverity":0},{"id":81411,"block":false,"minSeverity":0},{"id":81412,"block":false,"minSeverity":0},{"id":81413,"block":false,"minSeverity":0},{"id":81414,"block":false,"minSeverity":0},{"id":81417,"block":false,"minSeverity":0},{"id":81418,"block":false,"minSeverity":0},{"id":81419,"block":false,"minSeverity":0},{"id":8142,"block":false,"minSeverity":0},{"id":81420,"block":false,"minSeverity":0},{"id":81421,"block":false,"minSeverity":0},{"id":81422,"block":false,"minSeverity":0},{"id":81423,"block":false,"minSeverity":0},{"id":81424,"block":false,"minSeverity":0},{"id":81425,"block":false,"minSeverity":0},{"id":81426,"block":false,"minSeverity":0},{"id":8143,"block":false,"minSeverity":0},{"id":8144,"block":false,"minSeverity":0},{"id":8145,"block":false,"minSeverity":0},{"id":8146,"block":false,"minSeverity":0},{"id":8147,"block":false,"minSeverity":0},{"id":8148,"block":false,"minSeverity":0},{"id":8149,"block":false,"minSeverity":0},{"id":8151,"block":false,"minSeverity":0},{"id":8152,"block":false,"minSeverity":0},{"id":8153,"block":false,"minSeverity":0},{"id":8154,"block":false,"minSeverity":0},{"id":8155,"block":false,"minSeverity":0},{"id":8156,"block":false,"minSeverity":0},{"id":8211,"block":false,"minSeverity":0},{"id":82112,"block":false,"minSeverity":0},{"id":82113,"block":false,"minSeverity":0},{"id":8212,"block":false,"minSeverity":0},{"id":8213,"block":false,"minSeverity":0},{"id":8214,"block":false,"minSeverity":0},{"id":8215,"block":false,"minSeverity":0},{"id":8223,"block":false,"minSeverity":0},{"id":8224,"block":false,"minSeverity":0},{"id":8225,"block":false,"minSeverity":0},{"id":8226,"block":false,"minSeverity":0},{"id":8227,"block":false,"minSeverity":0},{"id":8228,"block":false,"minSeverity":0},{"id":8229,"block":false,"minSeverity":0},{"id":8230,"block":false,"minSeverity":0},{"id":8231,"block":false,"minSeverity":0},{"id":8232,"block":false,"minSeverity":0},{"id":8311,"block":false,"minSeverity":0},{"id":83114,"block":false,"minSeverity":0},{"id":83117,"block":false,"minSeverity":0},{"id":83118,"block":false,"minSeverity":0},{"id":83119,"block":false,"minSeverity":0},{"id":8313,"block":false,"minSeverity":0},{"id":8314,"block":false,"minSeverity":0},{"id":8315,"block":false,"minSeverity":0},{"id":8316,"block":false,"minSeverity":0},{"id":8318,"block":false,"minSeverity":0}]},"allCompliance":true,"alertThreshold":{"disabled":false,"value":0},"blockThreshold":{"enabled":false,"value":0},"graceDays":0,"verbose":false,"onlyFixed":false,"cveRules":[]}],"policyType":"hostCompliance","_id":"hostCompliance","type":"compliance","policyContext":"host"}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] != "18"

- name: Update host radar settings (19.07+)
  uri:
    url: "{{ twistlock_console }}/api/v1/policies/firewall/network/host"
    method: PUT
    user: "{{ console_user }}"
    password: "{{ console_password }}"
    body: '{"policy":{"_id":"hostNetworkFirewall","multihostDetection":true}}'
    force_basic_auth: yes
    body_format: json
    validate_certs: no
    status_code: 200
  when: twistlock_version.split('.')[0] != "18" and (twistlock_version.split('.')[1] != "03" and twistlock_version.split('.')[0] == "19")


